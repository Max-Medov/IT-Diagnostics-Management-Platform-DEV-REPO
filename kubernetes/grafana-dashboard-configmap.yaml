apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-configmap
  namespace: it-diagnostics
data:
  it-diagnostics-dashboard.json: |
    {
      "title": "IT Diagnostics: All Services Dashboard",
      "editable": true,
      "graphTooltip": 0,
      "panels": [
        {
          "title": "Auth: Request Count",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_total{pod=~\"auth-service-.*\"}",
              "intervalFactor": 1,
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 0 }
        },
        {
          "title": "Auth: Error Rate",
          "type": "timeseries",
          "targets": [
            {
              "expr": "rate(flask_http_request_total{pod=~\"auth-service-.*\", status=~\"4..\"}[1m])",
              "legendFormat": "4xx",
              "refId": "A"
            },
            {
              "expr": "rate(flask_http_request_total{pod=~\"auth-service-.*\", status=~\"5..\"}[1m])",
              "legendFormat": "5xx",
              "refId": "B"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 0 }
        },
        {
          "title": "Auth: Request Latency",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_duration_seconds_count{pod=~\"auth-service-.*\"}",
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 0 }
        },

        {
          "title": "Case: Request Count",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_total{pod=~\"case-service-.*\"}",
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 8 }
        },
        {
          "title": "Case: Error Rate",
          "type": "timeseries",
          "targets": [
            {
              "expr": "rate(flask_http_request_total{pod=~\"case-service-.*\",status=~\"4..\"}[1m])",
              "legendFormat": "4xx",
              "refId": "A"
            },
            {
              "expr": "rate(flask_http_request_total{pod=~\"case-service-.*\",status=~\"5..\"}[1m])",
              "legendFormat": "5xx",
              "refId": "B"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 8 }
        },
        {
          "title": "Case: Request Latency",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_duration_seconds_count{pod=~\"case-service-.*\"}",
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 8 }
        },

        {
          "title": "Diagnostic: Request Count",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_total{pod=~\"diagnostic-service-.*\"}",
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 16 }
        },
        {
          "title": "Diagnostic: Error Rate",
          "type": "timeseries",
          "targets": [
            {
              "expr": "rate(flask_http_request_total{pod=~\"diagnostic-service-.*\",status=~\"4..\"}[1m])",
              "legendFormat": "4xx",
              "refId": "A"
            },
            {
              "expr": "rate(flask_http_request_total{pod=~\"diagnostic-service-.*\",status=~\"5..\"}[1m])",
              "legendFormat": "5xx",
              "refId": "B"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 16 }
        },
        {
          "title": "Diagnostic: Request Latency",
          "type": "timeseries",
          "targets": [
            {
              "expr": "flask_http_request_duration_seconds_count{pod=~\"diagnostic-service-.*\"}",
              "legendFormat": "{{method}} {{status}}",
              "refId": "A"
            }
          ],
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 16 }
        }
      ],
      "schemaVersion": 36,
      "version": 1
    }

